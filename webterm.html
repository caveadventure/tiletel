
<html>
  <head>
    <meta charset="UTF-8">
    <style>
      #status {
        background-color: #0A0A0A;
        font: 12px monospace;
      }

      #fullscreen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        }
    </style>
  </head>
  <body>
    <script type="text/javascript">

      var socket = new WebSocket('ws://localhost:8080/run');
      socket.binaryType = 'arraybuffer';

      var resizer = function() {
          var w = document.getElementById("fullscreen").clientWidth - 3;
          var h = document.getElementById("fullscreen").clientHeight - 3;
          socket.send('r' + w + ' ' + h);
      };

      var pressor = function(event) {

          if (event.which > 0) {

              socket.send('k'+String.fromCharCode(event.which));

          } else if (event.keyCode > 0) {
              socket.send('c'+event.keyCode);
          }
      };

      try {
          socket.onopen = function() {
              document.body.style.backgroundColor = '#000f00';
              //document.getElementById('status').textContent = 'Connection opened';
              resizer();
          }

          socket.onmessage = function(msg) {
              var arrayBuffer = msg.data;
              var bytes = new Uint8Array(arrayBuffer);
              var blob = new Blob([bytes.buffer]);

              var image = document.getElementById('image');

              var reader = new FileReader();
              reader.onload = function(e) {
                  image.src = e.target.result;
              };
              reader.readAsDataURL(blob);
          }

          socket.onclose = function(){
              document.body.style.backgroundColor = '#F0F0F0';
              //document.getElementById('status').textContent = 'Connection closed';
          }

          socket.onerror = function(){
              document.body.style.backgroundColor = '#ff4040';
              //document.getElementById('status').textContent = 'Error!';
          }

      } catch(exception) {
          document.body.style.backgroundColor = '#ff4040';
          console.log('Error: ' + exception);
          //document.getElementById('status').textContent = 'Error! (' + exception + ')';
      }

      window.addEventListener("keypress", pressor, false);
      window.addEventListener("resize", resizer, false);
      window.addEventListener("orientationchange", resizer, false);

    </script>

    <div id="fullscreen">
      <img id="image">
    </div>

  </body>
</html>

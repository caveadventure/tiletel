
<html>
  <head>
    <meta charset="UTF-8">
    <style>
      #status {
        background-color: #0A0A0A;
        font: 12px monospace;
      }
    </style>
  </head>
  <body>
    <script type="text/javascript">

      var socket = new WebSocket('ws://localhost:8080/run');
      socket.binaryType = 'arraybuffer';

      var resizer = function() {
          socket.send('r' + (window.innerWidth - 32) + ' ' + (window.innerHeight - 32));
      };

      var pressor = function(event) {

          if (event.which > 0) {

              socket.send('k'+String.fromCharCode(event.which));

          } else if (event.keyCode > 0) {
              socket.send('c'+event.keyCode);
          }
      };

      try {
          socket.onopen = function() {
              document.getElementById('status').style.color = '#40ff40';
              document.getElementById('status').textContent = 'Connection opened';
              resizer();
          }

          socket.onmessage = function(msg) {
              var arrayBuffer = msg.data;
              var bytes = new Uint8Array(arrayBuffer);
              var blob = new Blob([bytes.buffer]);

              var image = document.getElementById('image');

              var reader = new FileReader();
              reader.onload = function(e) {
                  image.src = e.target.result;
              };
              reader.readAsDataURL(blob);
          }

          socket.onclose = function(){
              document.getElementById('status').style.color = '#ff4040';
              document.getElementById('status').textContent = 'Connection closed';
          }

          socket.onerror = function(){
              document.getElementById('status').style.color = '#ff4040';
              document.getElementById('status').textContent = 'Error!';
          }

      } catch(exception) {
          document.getElementById('status').style.color = '#ff4040';
          document.getElementById('status').textContent = 'Error! (' + exception + ')';
      }

      window.addEventListener("keypress", pressor, false);
      window.addEventListener("resize", resizer, false);
      window.addEventListener("orientationchange", resizer, false);

    </script>

    <img id="image">
    <br>
    <div id="status">...</div>
  </body>
</html>
